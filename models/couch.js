// Generated by CoffeeScript 1.9.1
(function() {
  var con, cradle, express, getDb;

  express = require('express');

  cradle = require('cradle_security')({
    debug: true
  });

  cradle.setup({
    host: 'http://localhost',
    port: 5984,
    cache: true,
    raw: false,
    forceSave: true
  });

  con = new cradle.Connection({
    auth: {
      username: 'root',
      password: 'StrongPassWord'
    }
  });

  getDb = function(db_name, cb) {
    var db;
    db = con.database(db_name);
    db.exists(function(err, exists) {
      if (err) {
        console.log('error', err);
      } else if (exists) {
        console.log('the force is with you.');
        cb();
      } else {
        console.log('database does not exists.');
        db.create(function(create_err) {
          if (create_err) {
            console.log('не удалось создать базу' + db_name);
            console.log(create_err);
          } else {
            db.save('_security', {
              readers: {
                roles: ['ROLE_USER']
              }
            });
            cb();
          }
        });
      }
    });
    return db;
  };

  module.exports.getDb = getDb;

}).call(this);
