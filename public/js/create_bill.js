// Generated by CoffeeScript 1.9.1
(function() {
  var addPurchaseLine, setTypeahead;

  addPurchaseLine = function() {
    var new_line;
    new_line = $('.product-params').first().clone();
    new_line.removeClass('hidden-group');
    $('.products').append(new_line);
    return setTypeahead();
  };

  setTypeahead = function() {
    return $('.typeahead').typeahead({
      source: function(query, process) {
        return $.get('/list/products', {
          query: query
        }, function(data) {
          return process(data);
        });
      },
      autoSelect: true
    });
  };

  $(function() {
    addPurchaseLine();
    $('#create_bill').submit(function(e) {
      var form;
      form = this;
      console.log(form.title);
      $('.product-params').each(function() {
        var product;
        product = {};
        product.title = $('[name="title"]', this);
        return console.log(product);
      });
      console.log($(form).serialize());
      return console.log($(form).serializeArray());
    });
    $(document).on('change', '.product-title', function(e) {
      if ($('.product-title').last().val() !== '') {
        return addPurchaseLine();
      }
    });
    setTypeahead();
    return $(document).on('change', '.typeahead', function(e) {
      var current, input, parent;
      input = $(e.currentTarget);
      parent = input.closest('.product-params');
      current = input.typeahead('getActive');
      if (current) {
        if (current.name.toLowerCase() === input.val().toLowerCase()) {
          parent.find('.product-id').val(current.id);
          parent.find('.add-purchase').attr('disabled', true);
          parent.find('.add-purchase .glyphicon').removeClass('red-text');
          input.removeClass('warning-field');
        } else {
          parent.find('.add-purchase').removeAttr('disabled');
          parent.find('.add-purchase .glyphicon').addClass('red-text');
          input.addClass('warning-field');
        }
      } else {
        parent.find('.add-purchase').removeAttr('disabled');
        parent.find('.add-purchase .glyphicon').addClass('red-text');
        input.addClass('warning-field');
      }
    });
  });

}).call(this);
